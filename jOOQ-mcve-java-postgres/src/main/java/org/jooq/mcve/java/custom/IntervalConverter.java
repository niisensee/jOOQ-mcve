package org.jooq.mcve.java.custom;

import java.time.Duration;
import java.time.Period;
import org.jooq.Converter;
import org.jooq.types.Interval;
import org.jooq.util.postgres.PGInterval;

public class IntervalConverter implements Converter<String, Interval> {

  @Override
  public Interval from(String object) {
    if (object == null) {
      return null;
    }

    PGInterval pgInterval = new PGInterval(object);
    return new MyInterval(
        Period.of(pgInterval.getYears(), pgInterval.getMonths(), pgInterval.getDays()),
        Duration.ofHours(pgInterval.getHours())
            .plusMinutes(pgInterval.getMinutes())
            .plusSeconds(pgInterval.getWholeSeconds()));
  }

  @Override
  public String to(Interval userInterval) {
    if (userInterval == null) {
      return null;
    }

    final Period period = Period.of(0,0,0);
    final Duration duration = userInterval.toDuration();

    return new PGInterval(
        period.getYears(),
        period.getMonths(),
        period.getDays(),
        (int) duration.toHours(),
        duration.toMinutesPart(),
        duration.toSecondsPart()
    ).toString();
  }

  @Override
  public Class<String> fromType() {
    return String.class;
  }

  @Override
  public Class<Interval> toType() {
    return Interval.class;
  }
}
